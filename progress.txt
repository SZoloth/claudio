## Codebase Patterns

- SwiftUI macOS menu bar app using `MenuBarExtra` with `.window` style
- `@Observable` pattern (macOS 14+) for state management in ViewModels
- File watching via `DispatchSource.makeFileSystemObjectSource`
- TOML config parsing using regex (no external dependencies)
- Session grouping with 5-minute time gap threshold for multi-turn conversations
- Xcode project structure: App/, Models/, ViewModels/, Services/, Views/
- brabble logs at ~/Library/Application Support/brabble/
- brabble config at ~/.config/brabble/config.toml

---

## 2026-01-22 - Stories 1-17

### Initial Implementation (All Stories)
- Created complete Claudio app with all 17 PRD stories passing
- Files: ClaudioApp.swift, Models/*.swift, ViewModels/*.swift, Services/*.swift, Views/*.swift

### Learnings for future iterations:
- When adding new Swift files, must manually edit project.pbxproj to include them
- PBXBuildFile, PBXFileReference, PBXGroup, and PBXSourcesBuildPhase all need entries
- ConfigParser uses regex to parse TOML since no Swift TOML library included
- ConversationSession groups turns by temporal proximity (5-min gap = new session)
- Wake word display shows all aliases: "claudio" or "claude"

---

## 2026-01-22 - Multi-Turn Conversations

### Implementation
- Modified `~/agent-tools/brabble-claude-hook.sh` to use `--continue` flag
- Session state stored in `~/.config/brabble/claude-session/`
- Trigger phrases for new session: "new conversation", "start over", "fresh start", "forget everything"

### Learnings for future iterations:
- Claude Code's `--continue` flag resumes last conversation in working directory
- No explicit session ID tracking needed - just run from consistent directory
- Claude handles context compaction automatically for long conversations

---

## 2026-01-22 - Live Transcription Feature (compound/live-transcription)

### Implementation
- Added TranscriptionView showing real-time transcription text in popover
- Created FloatingTranscriptionWindow.swift for persistent NSPanel overlay
- Panel shows at top of screen during transcription, visible without opening popover
- Uses blinking cursor animation and fade transitions

### Learnings for future iterations:
- `@MainActor` classes called from non-isolated contexts need `Task { @MainActor in }` dispatch
- NSPanel with `.nonactivatingPanel` style doesn't steal keyboard focus
- `.collectionBehavior = [.canJoinAllSpaces, .fullScreenAuxiliary]` for visibility in all spaces
- NSHostingView bridges AppKit window management to SwiftUI content

---

## 2026-01-22 - Stats View Feature (compound/add-stats-view)

### Implementation
- Added SessionStats model with HealthStatus enum for tracking daily metrics
- Created StatsService that aggregates data from multiple log parsers
- Built StatsView with collapsible UI showing health indicator, metrics grid, and warnings
- Integrated into MenuBarView as a section between header and conversations

### Learnings for future iterations:
- Can reuse existing parsers (ClaudeHookLogParser, TranscriptLogParser) for aggregation
- HealthStatus thresholds: green >90%, yellow 70-90%, red <70% success rate
- Stats section works best above conversation list to provide context
- Warning counts (overflow, no speech) parsed with same grep patterns as claudio-report.sh

---
