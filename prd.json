{
  "project": "Claudio",
  "branchName": "compound/settings-system",
  "description": "Add settings system with provider selection, API keys, model choice, clipboard toggle, and transcribe-only mode",
  "tasks": [
    {
      "id": "T-001",
      "title": "Create AppSettings model with @AppStorage",
      "description": "Create the core settings model using SwiftUI's @AppStorage for persistence",
      "acceptanceCriteria": [
        "File `Claudio/Services/AppSettings.swift` exists",
        "Contains `@Observable class AppSettings`",
        "Has @AppStorage properties: provider, model, copyToClipboard, transcribeOnlyMode, speakResponse",
        "Provider enum with cases: claude, openai, ollama",
        "Run `./build.sh` - exits with code 0"
      ],
      "priority": 1,
      "passes": true
    },
    {
      "id": "T-002",
      "title": "Add AppSettings to Xcode project",
      "description": "Update project.pbxproj to include AppSettings.swift",
      "acceptanceCriteria": [
        "AppSettings.swift added to PBXBuildFile section",
        "AppSettings.swift added to PBXFileReference section",
        "AppSettings.swift added to Services PBXGroup",
        "Run `./build.sh` - exits with code 0"
      ],
      "priority": 2,
      "passes": true
    },
    {
      "id": "T-003",
      "title": "Create KeychainService for API key storage",
      "description": "Secure storage for API keys using macOS Keychain",
      "acceptanceCriteria": [
        "File `Claudio/Services/KeychainService.swift` exists",
        "Has `func saveAPIKey(_ key: String, for provider: String)`",
        "Has `func getAPIKey(for provider: String) -> String?`",
        "Has `func deleteAPIKey(for provider: String)`",
        "Uses Security framework for Keychain access",
        "Run `./build.sh` - exits with code 0"
      ],
      "priority": 3,
      "passes": true
    },
    {
      "id": "T-004",
      "title": "Add KeychainService to Xcode project",
      "description": "Update project.pbxproj to include KeychainService.swift",
      "acceptanceCriteria": [
        "KeychainService.swift added to all required project.pbxproj sections",
        "Run `./build.sh` - exits with code 0"
      ],
      "priority": 4,
      "passes": true
    },
    {
      "id": "T-005",
      "title": "Create SettingsWriter service",
      "description": "Service that writes settings to hook-config.sh for bash script access",
      "acceptanceCriteria": [
        "File `Claudio/Services/SettingsWriter.swift` exists",
        "Has `func writeHookConfig(settings: AppSettings)`",
        "Writes to `~/.config/claudio/hook-config.sh`",
        "Exports: CLAUDIO_PROVIDER, CLAUDIO_MODEL, CLAUDIO_COPY_CLIPBOARD, CLAUDIO_TRANSCRIBE_ONLY, CLAUDIO_SPEAK_RESPONSE",
        "Run `./build.sh` - exits with code 0"
      ],
      "priority": 5,
      "passes": true
    },
    {
      "id": "T-006",
      "title": "Add SettingsWriter to Xcode project",
      "description": "Update project.pbxproj to include SettingsWriter.swift",
      "acceptanceCriteria": [
        "SettingsWriter.swift added to all required project.pbxproj sections",
        "Run `./build.sh` - exits with code 0"
      ],
      "priority": 6,
      "passes": true
    },
    {
      "id": "T-007",
      "title": "Add Provider section to SettingsView",
      "description": "Add LLM provider picker to settings UI",
      "acceptanceCriteria": [
        "SettingsView has Section labeled 'LLM Provider'",
        "Contains Picker for provider selection",
        "Shows options: Claude, OpenAI, Ollama",
        "Selection persists via AppSettings",
        "Run `./build.sh` - exits with code 0"
      ],
      "priority": 7,
      "passes": true
    },
    {
      "id": "T-008",
      "title": "Add API Key section to SettingsView",
      "description": "Add secure API key input field",
      "acceptanceCriteria": [
        "SettingsView has Section labeled 'API Key'",
        "Contains SecureField for API key entry",
        "Shows which provider the key is for",
        "Save button stores key via KeychainService",
        "Shows checkmark when key is saved",
        "Run `./build.sh` - exits with code 0"
      ],
      "priority": 8,
      "passes": true
    },
    {
      "id": "T-009",
      "title": "Add Model section to SettingsView",
      "description": "Add model picker filtered by selected provider",
      "acceptanceCriteria": [
        "SettingsView has Section labeled 'Model'",
        "Contains Picker for model selection",
        "Options change based on selected provider",
        "Claude: opus, sonnet, haiku",
        "OpenAI: gpt-4o, gpt-4o-mini, o1, o3-mini",
        "Ollama: shows text field for model name",
        "Run `./build.sh` - exits with code 0"
      ],
      "priority": 9,
      "passes": true
    },
    {
      "id": "T-010",
      "title": "Add Behavior section to SettingsView",
      "description": "Add toggles for clipboard and speech output",
      "acceptanceCriteria": [
        "SettingsView has Section labeled 'Behavior'",
        "Contains Toggle for 'Copy response to clipboard'",
        "Contains Toggle for 'Speak response aloud'",
        "Both toggles persist via AppSettings",
        "Run `./build.sh` - exits with code 0"
      ],
      "priority": 10,
      "passes": true
    },
    {
      "id": "T-011",
      "title": "Add Mode section to SettingsView",
      "description": "Add mode picker for conversation vs transcribe-only",
      "acceptanceCriteria": [
        "SettingsView has Section labeled 'Mode'",
        "Contains Picker with segmented style",
        "Options: Conversation, Transcribe Only",
        "Transcribe Only shows description: 'Transcribe speech, clean up with AI, copy to clipboard'",
        "Selection persists via AppSettings",
        "Run `./build.sh` - exits with code 0"
      ],
      "priority": 11,
      "passes": true
    },
    {
      "id": "T-012",
      "title": "Initialize AppSettings in ClaudioApp",
      "description": "Create and inject AppSettings into the app",
      "acceptanceCriteria": [
        "ClaudioApp creates AppSettings instance as @State",
        "AppSettings passed to ClaudioViewModel",
        "Settings available throughout app via environment or dependency",
        "Run `./build.sh` - exits with code 0"
      ],
      "priority": 12,
      "passes": true
    },
    {
      "id": "T-013",
      "title": "Write hook config on settings change",
      "description": "Call SettingsWriter when any relevant setting changes",
      "acceptanceCriteria": [
        "SettingsView calls SettingsWriter.writeHookConfig on dismiss or onChange",
        "Config file created at ~/.config/claudio/hook-config.sh",
        "File contains export statements for all settings",
        "Run `./build.sh` - exits with code 0"
      ],
      "priority": 13,
      "passes": true
    },
    {
      "id": "T-014",
      "title": "Update hook script to source config",
      "description": "Modify brabble-claude-hook.sh to read settings from config file",
      "acceptanceCriteria": [
        "Hook script sources ~/.config/claudio/hook-config.sh if it exists",
        "Falls back to defaults if config missing",
        "Uses CLAUDIO_MODEL instead of hardcoded 'opus'",
        "Uses CLAUDIO_SPEAK_RESPONSE to conditionally call say",
        "Run `./build.sh` - exits with code 0"
      ],
      "priority": 14,
      "passes": true
    },
    {
      "id": "T-015",
      "title": "Add multi-provider support to hook script",
      "description": "Hook script uses configured provider and API key",
      "acceptanceCriteria": [
        "Hook script checks CLAUDIO_PROVIDER",
        "For claude: uses existing claude CLI with CLAUDIO_MODEL",
        "For openai: uses curl to OpenAI API with CLAUDIO_API_KEY",
        "For ollama: uses curl to local Ollama API",
        "Run `./build.sh` - exits with code 0"
      ],
      "priority": 15,
      "passes": true
    },
    {
      "id": "T-016",
      "title": "Add clipboard support to hook script",
      "description": "Optionally copy response to clipboard",
      "acceptanceCriteria": [
        "Hook script checks CLAUDIO_COPY_CLIPBOARD",
        "If true, pipes response to `pbcopy`",
        "Works for both conversation and transcribe-only modes",
        "Run `./build.sh` - exits with code 0"
      ],
      "priority": 16,
      "passes": true
    },
    {
      "id": "T-017",
      "title": "Implement transcribe-only mode in hook script",
      "description": "When in transcribe-only mode, clean text and copy to clipboard",
      "acceptanceCriteria": [
        "Hook script checks CLAUDIO_TRANSCRIBE_ONLY",
        "If true, skips conversation with Claude",
        "Sends transcription to fast model (haiku) for cleanup",
        "Cleanup prompt: 'Clean up this transcription. Fix grammar, punctuation, remove filler words. Return only the cleaned text.'",
        "Copies cleaned text to clipboard via pbcopy",
        "Says 'Copied' or similar short confirmation if speak enabled",
        "Run `./build.sh` - exits with code 0"
      ],
      "priority": 17,
      "passes": true
    },
    {
      "id": "T-018",
      "title": "Add mode indicator to MenuBarView",
      "description": "Show current mode in the popover header",
      "acceptanceCriteria": [
        "StatusHeader shows mode indicator when in transcribe-only mode",
        "Indicator text: 'Transcribe Mode' with microphone icon",
        "Uses muted/secondary styling",
        "Run `./build.sh` - exits with code 0"
      ],
      "priority": 18,
      "passes": true
    },
    {
      "id": "T-019",
      "title": "Final integration test",
      "description": "Verify all settings work end-to-end",
      "acceptanceCriteria": [
        "Run `./build.sh` - exits with code 0",
        "App launches without errors",
        "Settings view opens and shows all sections",
        "Config file generated at ~/.config/claudio/hook-config.sh",
        "Changing settings updates config file"
      ],
      "priority": 19,
      "passes": true
    }
  ]
}
